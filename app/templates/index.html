<!DOCTYPE html>
<html>
<head>
    <title>Weather API Tester</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Inclure Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/jsLKmRVo51Ynx4JDE=" crossorigin=""/>
</head>
<body>
    <h1>Stations Météo et Données Climatiques</h1>
    
    <!-- Carte -->
    <div id="map"></div>

    <!-- Formulaire pour les données météo -->
    <form id="weatherForm" method="GET">
        <label>Station ID: <input type="text" name="station_id" id="station_id" required></label><br>
        <label>Mois: <input type="number" name="month" id="month" min="1" max="12" required></label><br>
        <label>Jour: <input type="number" name="day" id="day" min="1" max="31" required></label><br>
        <button type="submit">Obtenir les données</button>
    </form>
    <div id="result"></div>

    <!-- Inclure Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Script pour charger la carte et les stations -->
    <script>
        // Initialiser la carte
        var map = L.map('map').setView([45.5017, -73.5673], 5); // Centré sur Montréal par défaut
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Charger les stations depuis l'API
        fetch('/stations')
            .then(response => response.json())
            .then(data => {
                data.forEach(station => {
                    L.marker([station.lat, station.lon])
                        .addTo(map)
                        .bindPopup(`Station ID: ${station.id}<br>Lat: ${station.lat}<br>Lon: ${station.lon}`)
                        .on('click', () => {
                            document.getElementById('station_id').value = station.id;
                        });
                });
            });

        // Gérer le formulaire
        document.getElementById('weatherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const stationId = document.getElementById('station_id').value;
            const month = document.getElementById('month').value.padStart(2, '0');
            const day = document.getElementById('day').value.padStart(2, '0');
            fetch(`/station/indicator/${stationId}/${month}/${day}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('result').innerHTML = 
                        `<h3>Résultat:</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = 'Erreur: ' + error;
                });
        });
    </script>
</body>
</html>